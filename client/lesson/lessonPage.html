<template name="lessonMap">
      {{> googleMap name="lessonMap" options=mapOptions}}
</template>

<template name="lessonPage">
  <div id="fb-root"></div>
  <script>(function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/fr_FR/sdk.js#xfbml=1&version=v2.8&appId=743688789123679";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));</script>
  {{#with lesson}}
    <div class="section" style="
                              height:60vh;
                              width:100vw;
                              background: -moz-linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.4)), url({{imgUrl}}) no-repeat center center;
                              background: -webkit-linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.4)), url({{imgUrl}}) no-repeat center center;
                              background: -o-linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.4)), url({{imgUrl}}) no-repeat center center;
                              background: linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.4)), url({{imgUrl}}) no-repeat center center;
                              -webkit-background-size: cover;
                              -moz-background-size: cover;
                              -o-background-size: cover;
                              background-size: cover;
                              ">
    <div class="container v-align-transform">
      <div class="row firstRow">
        <div class="col m10 push-m1 s12 center-align">
          <h2 class="mb8" style="color:white;">{{title}}</h2>
        </div>
      </div>
    </div>
  </div>

    <div class="row background-lesson-page firstRow">
      <div class="container">
        <div class="row" style="padding-top:30px;">
          <div class="col s12 m7">
            {{#with coach}}
              <div class="card-panel">
                <div class="row firstRow">
                  <img src="{{coachImgUrl}}" alt="Photo de profil" class="circle left" width="70px;" height="70px;" style="margin-right:10px;">
                  <span class="title"><a href="#">{{coachName}}</a></span>
                  <p>
                    {{description}}
                  </p>
                </div>
              </div>
            {{/with}}
          </div>
          <div class="col s12 m4 offset-m1">
            <div class="card-panel">
              <div class="row firstRow">
                  <h5>Aller avec un ami</h5>
                  <!--Email input form
                  <hr>-->
                  <div class="fb-share-button" data-href="{{currentUrl}}" data-layout="button" data-size="small" data-mobile-iframe="true"><a class="fb-xfbml-parse-ignore" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fdevelopers.facebook.com%2Fdocs%2Fplugins%2F&amp;src=sdkpreparse">Share</a></div>
                  <div class="fb-send" data-href="{{currentUrl}}" data-layout="button_count"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col s12 m6 l7">
            <div class="card-panel">
              <div class="row firstRow" style="padding-right:20px;padding-left:20px;">
                  <h3 class="padding-top-10 bold">{{title}}</h3>
                  <div class="row firstRow">
                    <div class="col s4 level-body">
                      <center>
                        <div class="row firstRow">
                          <div id="intensitydots"><i class="material-icons level-icon">fiber_manual_record</i></div>

                        </div>
                      </center>
                    </div>
                    <div class="col s4 level-mind">
                      <center>
                        <div class="row firstRow">
                          <div id="mindfuldots"><i class="material-icons level-icon">fiber_manual_record</i></div>
                        </div>
                      </center>
                    </div>
                    <div class="col s4 level-know">
                      <center>
                        <div class="row firstRow">
                          <span class="lev-i bold level-icon">B</span>
                        </div>
                      </center>
                    </div>
                  </div>
                  <div class="row">
                    <center>
                      <div class="col s4">
                        Intensité
                      </div>
                      <div class="col s4">
                        Mindful
                      </div>
                      <div class="col s4">
                        {{level}}
                      </div>
                    </center>
                  </div>

                  <div class="divider"></div>
                  <h4 style="margin-top:10px;">{{_ "lesson.description"}}</h4>
                  <p class="">{{longDesc}}</p>

                  <div class="divider"></div>
                  <h4 style="margin-top:10px;">{{_ "lesson.address"}}</h4>
                  <p><i class="material-icons left">location_on</i>{{address}}</p>

                  <div class="divider"></div>
                  <h4 style="margin-top:10px;">Facilités</h4>
                  <p>{{facility}}</p>
                  <!--<div class="facilities">{{facility}}</div>-->

                  <div class="divider"></div>
                  <h4 style="margin-top:10px;">Comment se préparer</h4>
                  <p>{{preparation}}</p>

                  <div class="divider"></div>
                  <h4 style="margin-top:10px;">{{_ "lesson.next-classes"}}</h4>
                  <div class="collection center-align">
                    {{#each nextDates}}
                      <a href="#!" class="collection-item nextDate">
                        <div class="row firstRow">
                          <div class="col m3">
                            {{dateForHuman}}
                          </div>
                          <div class="col m3">
                            {{timeForHuman}}
                          </div>
                          <div class="col m3">
                            {{thisDuration}} min
                          </div>
                          <div class="col m3">
                            {{thisPrice}}€
                          </div>
                        </div>
                      </a>
                    {{/each}}
                </div>
            </div>
          </div>
        </div>
        <div class="col m1">
        </div>
        <div class="col l4 m5 s12">
          {{#with selectedDate}}
          <div class="card-panel red accent-2">
              <div class="priceReservationCard">
                <div class="center-align">
                  €
                  <span style="font-size:64px;">{{price}}</span>
                </div>

              <div class="" style="font-size:20px; margin-top:30px;">
                <ul class="ulReservationCard">
                  <li>
                    <i class="material-icons">event</i>
                    {{date}}
                  </li>
                  <li>
                    <i class="material-icons">schedule</i>
                    {{time}}
                  </li>
                  <li>
                    <i class="material-icons">update</i>
                    {{duration}} min
                  </li>
                </ul>
              </div>
            </div>

            <div class="row center-align">
              <button id="reservation" class="waves-effect waves-teal btn cyan darken-2">
                {{_ "lesson.booking-button"}}
              </button>
            </div>
          </div>
            <!--<div class="card-panel white-text green">
              <b>{{earning}} {{_ "lesson.points-card"}}</b>
            </div>-->
          {{/with}}
        </div>
      </div>
    </div>

    <div class="">
      <div class="col s12 map-container" style="
        margin:0 0 0 0 !important;
        padding:30px 0 0 0 !important;
        width : 100vw;
        height : 300px;
        position:relative;
      ">
        {{> lessonMap}}
      </div>
    </div>
  </div>
  <script>
    var lesson = Lessons.findOne(FlowRouter.getParam('lessonId'));
    var int = lesson.intensity;
    var mind = lesson.mindful;
    var lev = lesson.level;

    if(int){
      var dot = '<i class="material-icons level-icon">fiber_manual_record</i>';
      var dots='';
      for(var i = 0; i<int;i++){
        dots += dot;
      }
      $("#intensitydots").html(dots);
    }

    if(mind){
      var dot = '<i class="material-icons level-icon">fiber_manual_record</i>';
      var dots='';
      for(var i = 0; i<mind;i++){
        dots += dot;
      }
      $("#mindfuldots").html(dots);
    }

    if(lev){
      switch(lev) {
        case "Beginner" : $(".lev-i").html('<span class="lev-i bold level-icon">B</span>'); break;
        case "Intermediate" : $(".lev-i").html('<span class="lev-i bold level-icon">I</span>'); break;
        case "Advanced" : $(".lev-i").html('<span class="lev-i bold level-icon">A</span>'); break;
        case "All" : $(".lev-i").html('<span class="lev-i bold level-icon">T</span>'); break;
      }
    }
  </script>
{{/with}}
</template>
